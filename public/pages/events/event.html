<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VARAZZERS FESTIVAL | EVENT </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="/assets/css/style-new.css">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="/assets/js/navbar_and_footer_loader.js"></script>
    <script src="/assets/js/utils.js"></script>

    <script type="module">
        import Event from "../../assets/js/modules/event.mjs";
        import cart from "../../assets/js/modules/cart.mjs"

        let eventId = getCookieValue('eveid');
        let event = new Event(eventId);
        let slideCount;
        let currentSlide = 0;

        $(document).ready(() =>
        {
            $("#correlated-seminars").hide();
            $("#correlated-events").hide();
        });

        event.fetchData(true).then(data =>
        {
            $('#event-title').text(event.title);
            $('#performer-title').text(`${event.performerFirstName} ${event.performerLastName}`);
            $('#performer-link').attr('href', `/performers/${event.performerId}`);
            $('#description').text(event.description);
            $('#eventprice').text(event.price);
            $('#location').text(event.location);

            let date = new Date(event.date);
            let dateNumber = date.getDate() < 10 ? `0${date.getDate()}` : date.getDate();
            let monthNumber = date.getMonth()+1 < 10 ? `0${date.getMonth()+1}` : date.getMonth()+1;
            $('#date').text(`${dateNumber}.${monthNumber}.${date.getFullYear()}`);

            $(".cart-btn").attr('href', event.eventId);
            $(".cart-btn").click(function (e)
            {
                $(".cart-btn").hide();
                $("#buy-loading").show();


                cart.addToCart($(this).attr('href')).then(() =>
                {
                    $("#buy-loading").hide();
                    $("#buy-check").show().attr('src', '/assets/images/icons/check.gif');
                    setTimeout(() =>
                    {
                        $(".cart-btn").show();
                        $("#buy-check").hide();
                    }, 1200);
                });
                e.preventDefault();
            });

            event.retrieveCoverImage().then(image =>
            {
                $('.banner-bg').css('background-image', `url("${image}")`);
            });

            event.getImages('all').then(imgs=>
            {
                $("#slide-loading").hide();
                slideCount = imgs.length;
                for(let i=0; i<imgs.length;i++)
                {
                    let img=imgs[i];
                    let slide= $(`<li class="slide" id="slide${i}">
                                   <img src="${img.image}">
                                  </li>`);

                    $('.slideshow .slide-list').append(slide);
                    $(`#slide${0}`).css('left', '0');
                }

                $(document).on('click', '.slideshow .next-slide', () => slide(1));
                $(document).on('click', '.slideshow .prev-slide', () => slide(-1));

            });

            event.getSeminars().then(seminars =>
            {
                if(seminars.length > 0)$("#correlated-seminars").show();
                else return;
                let seminarsList = $("#correlated-seminars ul");

                for(let seminar of seminars) createCorrelatedCard(seminarsList, seminar.coverImage, seminar.title, seminar.description);
            });

            event.getEventsOnSameDate().then(events =>
            {
                if(events.length > 0)$("#correlated-events").show();
                else return;
                let eventsList = $("#correlated-events ul");
                for(let event of events) createCorrelatedCard(eventsList, event.coverImage, event.title, event.description);
            })
        });

        function createCorrelatedCard(list, img, title, description)
        {
            let card = $(`<li class="correlated-card">
                                       <div class="card-img">
                                            <img src="${img}">
                                        </div>
                                        <div class="card-description">
                                            <h2>${title}</h2>
                                            <span>${description}</span>
                                        </div>
                                  </li>`);
            list.append(card);
        }

        function slide(x) {

            if(slide.lock1 || slide.lock2)return;

            slide.lock1 = true;
            slide.lock2 = true;

            let current = $(`#slide${currentSlide}`);

            currentSlide += x;
            if(currentSlide >= slideCount)currentSlide = 0;
            if(currentSlide < 0)currentSlide = slideCount-1;

            let next = $(`#slide${currentSlide}`);

            let width = current.outerWidth();

            current.animate({
                left: -width*x
            }, 400, () =>
            {
                current.css('left', '100%');
                slide.lock1 = false
            });

            if(x > 0)
            {
                next.animate({
                    left: 0
                }, 400, () => slide.lock2 = false);
            }
            else
            {
                next.css('left', 'auto').css('right', '100%').animate({
                    right: 0
                }, 400, () => slide.lock2 = false);
            }
        }

    </script>

</head>
<body>

<header></header>

<div class="banner" style="background-color: #FFF8E1">
    <div class="banner-bg"></div>
    <div class="headline" style="background-color: transparent">
    </div>
</div>

<div class="container-event">
    <main class="event-container">

        <div class="event-right-column">
            <div class="event-description">
                <a id="performer-link"><span id="performer-title"></span></a>
                <span style="color: black" id="event-title"></span>
                <p id="description"></p>
                <div style="display: flex; flex-direction: column">
                    <span id="location-title">Location:</span>
                    <span id="location"></span>
                </div>
                <span id="date"></span>
            </div>
            <div class="event-price">
                <span id="eventprice"></span>
                <div style="width: 90px; height: 48px; display:flex; justify-content: center">
                    <a href="#" class="cart-btn">BUY</a>
                    <img id="buy-loading" style="display: none" src="/assets/images/icons/loading.gif">
                    <img id="buy-check" style="display: none" src="/assets/images/icons/check.gif">
                </div>
            </div>
        </div>
        <div class="event-left-column">

            <div class="slideshow">
                <img id="slide-loading" src="/assets/images/icons/loading.gif" style="display: block; width: 44px; height: 44px; position: absolute; top: calc(50% - 22px); left: calc(50% - 22px);">
                <ul class="slide-list">

                </ul>
                <a class="next-slide">&gt;</a>
                <a class="prev-slide">&lt;</a>
            </div>

        </div>
    </main>

    <div class="correlated">
        <div id="correlated-seminars">
            <span>CORRELATED SEMINARS</span>
            <ul>

            </ul>
        </div>
        <div id="correlated-events">
            <span>EVENTS ON SAME DAY</span>
            <ul>

            </ul>
        </div>
    </div>
</div>
<footer></footer>
<div class="mobile-nav"></div>

</body>
</html>