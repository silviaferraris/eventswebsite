<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/css/style.css">
    <title>Silvia's website | sign up</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <style>
        p
        {
            color: wheat;
            background-color: rgba(0, 0, 0, 0.4);
            display: inline-block;
        }
    </style>

    <script>
        $(document).ready(() =>
        {
            $("#submit-btn").click(async () =>
            {
                let form = document.getElementById("signup-form");

                let validForm = form.checkValidity();
                if(!form.classList.contains('was-validated'))form.classList.add('was-validated');
                let goodUsername = await isUsernameGood();

                if(validForm && !goodUsername)document.getElementById("username-up").setCustomValidity("Invalid field.");
                else if(validForm && goodUsername)form.submit();
            });

            $("#username-up").change(async () =>
            {
                let goodUsername = await isUsernameGood();
                if(!goodUsername)
                {
                    $("#username-feedback").text("This username already exist.");
                    document.getElementById("username-up").setCustomValidity("Invalid field.");
                }
                else
                {
                    $("#username-feedback").text("Please choose a username.");
                    document.getElementById("username-up").setCustomValidity("");
                }
            });
        });

        async function isUsernameGood()
        {
            let username = document.getElementById("username-up").value;
            let response = await fetch(`/checkUsername?username=${username}`);
            return response.status === 404;
        }
    </script>

    <script src="/assets/js/navbar_and_footer_loader.js"></script>

</head>

<body>

<div id="navbar"></div>

<div>
    <form class="login-form needs-validation" id="signup-form" action="/register" method="post" novalidate>
        <h1 class="mb-5 font-weight-light text-uppercase">Sign Up</h1>

        <div class="mb-3">
            <label for="firstname-up">First name*</label>
            <input type="text" name="first_name" class="form-control rounded-pill form-control-lg" id="firstname-up" placeholder="First name" required>
            <div class="invalid-feedback">Please insert a first name.</div>
        </div>

        <div class="mb-3">
            <label for="lastname-up">Last name*</label>
            <input type="text" name="last_name" class="form-control rounded-pill form-control-lg" id="lastname-up" placeholder="Last name" required>
            <div class="invalid-feedback">Please insert a last name.</div>
        </div>

        <div class="mb-3">
            <label for="username-up">Username*</label>
            <input type="text" name="username" class="form-control rounded-pill form-control-lg" id="username-up" placeholder="Username" required>
            <div class="invalid-feedback" id="username-feedback">Please choose a username.</div>
        </div>

        <div class="mb-3">
            <label for="email-up">E-Mail*</label>
            <input type="email" name="email" class="form-control rounded-pill form-control-lg" id="email-up" placeholder="E-Mail" required>
            <div class="invalid-feedback">Please insert an e-mail.</div>
        </div>

        <div class="mb-3">
            <label for="psw-up">Password*</label>
            <input type="password" name="password" class="form-control rounded-pill form-control-lg" id="psw-up" placeholder="Password" required>
            <div class="invalid-feedback">Please insert a password.</div>
        </div>

        <div class="mb-3">
            <label for="birthday-up">Birthday*</label>
            <input type="date" name="birthday" class="form-control rounded-pill form-control-lg" id="birthday-up">
        </div>

        <input type="button" id="submit-btn" class="btn mt-5 rounded-pill btn-lg btn-custom btn-block text-uppercase" value="Sign up">
        <p class="mt-3 font-weight-normal">Have already an account?<a href="/login"><strong> Login </strong></a></p>
    </form>
</div>

<div id="footer"></div>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

</html>