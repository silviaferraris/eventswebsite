<script>

    console.log("Loading navbar...")

    $("#ftco-navbar").hide();
    //$("#nav-logout-btn").hide();
    $("#navbarDropdownMenuLink").hide();

    fetch('/user').then(async response =>
    {
        if(response.status === 401) return;

        let body = await response.json();

        $("#nav-login-btn").hide();
        //$("#nav-logout-btn").show();
        $("#navbarDropdownMenuLink").show();

        let avatar = body.avatar;
        let username = body.username;

        $("#navbarDropdownMenuLink img").attr('src', `/assets/images/default-avatars/avatar${avatar}.png`);
        $("#navbarDropdownMenuLink span").text(username);

    }).finally(() => {

        let path = window.location.pathname;
        $('#nav-links a[href="'+path+'"]').parent().addClass('active');

        if(path.startsWith('/login') || path.startsWith('/signup'))
        {
            $("#nav-login-btn").hide();
            //$("#nav-logout-btn").hide();
            $("#navbarDropdownMenuLink").hide();
        }

        $("#ftco-navbar").show();

    });

</script>

<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">

    <a class="navbar-brand" href="#"><span class="flaticon-lotus"></span>Varazzers Festival</a>

    <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-collapse collapse" id="ftco-nav">
        <ul class="navbar-nav" id="nav-links">
            <li class="nav-item"><a href="/" class="nav-link">home</a></li>
            <li class="nav-item"><a href="/faq/" class="nav-link">events</a></li>
            <li class="nav-item"><a href="/performers/" class="nav-link">performers</a></li>
            <li class="nav-item"><a href="/mycart/" class="nav-link">my cart</a></li>
            <li class="nav-item"><a href="/contactus/" class="nav-link">Contact me</a></li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown" style="padding-right: 20px; max-height: 50px;">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <img src="" width="35" height="35" style="display: inline-block" alt="avatar"/><span style="padding-left: 10px"></span>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                    <a class="dropdown-item" href="#"><img src="/assets/images/menu-icons/cart-icon.png" width="24" height="24"><span style="padding-left: 10px">My Cart</span></a>
                    <a class="dropdown-item" href="#"><img src="/assets/images/menu-icons/settings-icon.png" width="24" height="24"><span style="padding-left: 10px">Account settings</span></a>
                    <a class="dropdown-item logout-btn" href="/logout"><img src="/assets/images/menu-icons/logout-icon.png" width="24" height="24"><span style="padding-left: 10px">Logout</span></a>
                </div>
            </li>
            <a class="btn" href="#." type="button" onclick="location.href='/login'" target="_blank">login or signup</a>
            <!--button-- class="btn btn-outline-success" type="button" onclick="location.href='/login'" id="nav-login-btn">Login / Sign up</button-->
            <!--<button class="btn btn-sm btn-outline-secondary" type="button" style="min-width: 100px" onclick="location.href='/logout'" id="nav-logout-btn">Logout</button>-->
        </ul>
    </div>

</nav>